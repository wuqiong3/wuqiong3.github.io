System.register("chunks:///_virtual/BackgroundScroller.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var r,t,o,n,e,a,s,c,u,l,d;return{setters:[function(i){r=i.applyDecoratedDescriptor,t=i.inheritsLoose,o=i.createForOfIteratorHelperLoose,n=i.initializerDefineProperty,e=i.assertThisInitialized},function(i){a=i.cclegacy,s=i._decorator,c=i.Node,u=i.Camera,l=i.UITransform,d=i.Component}],execute:function(){var h,p,g,f,b,k,v;a._RF.push({},"94c39Y9E9JOxb3L914uU7Sp","BackgroundScroller",void 0);var _=s.ccclass,m=s.property;i("BackgroundScroller",(h=_("BackgroundScroller"),p=m([c]),g=m(u),h((k=r((b=function(i){function r(){for(var r,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return r=i.call.apply(i,[this].concat(o))||this,n(r,"backgrounds",k,e(r)),n(r,"camera",v,e(r)),r._width=0,r._initialized=!1,r}t(r,i);var a=r.prototype;return a.start=function(){this.initBackgrounds()},a.initBackgrounds=function(){if(this.backgrounds.length<2)console.warn("[BackgroundScroller] backgrounds 少于2，无法循环滚动");else{var i=this.backgrounds[0].getComponent(l);this._width=i?i.width*this.backgrounds[0].scale.x:1920;for(var r=0;r<this.backgrounds.length;r++)this.backgrounds[r].setPosition(r*this._width,0,0);this._initialized=!0}},a.update=function(i){if(this._initialized&&this.camera){for(var r,t=this.camera.node.position.x,n=this.backgrounds[0],e=o(this.backgrounds);!(r=e()).done;){var a=r.value;a.position.x>n.position.x&&(n=a)}for(var s,c=o(this.backgrounds);!(s=c()).done;){var u=s.value;t-u.position.x>this._width&&(u.setPosition(n.position.x+this._width,u.position.y,u.position.z),n=u)}}},r}(d)).prototype,"backgrounds",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=r(b.prototype,"camera",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=b))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlatformType.ts"],(function(t){var e,i,n,r,a,o,l,s,c,u,m,f,h,p,g,d,x,P,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,s=t.Node,c=t.Camera,u=t.Prefab,m=t.input,f=t.Input,h=t.math,p=t.Vec3,g=t.UITransform,d=t.instantiate,x=t.Component},function(t){P=t.PlatformType,_=t.PlatformKind}],execute:function(){var v,y,b,w,T,k,C,S,D,K,z,N,X,A,I,Y,F,j,G,M;o._RF.push({},"e0c100uNslNKYCv+TlfkIUn","GameManager",void 0);var E=l.ccclass,J=l.property;t("GameManager",(v=E("GameManager"),y=J(s),b=J(c),w=J(u),T=J(u),v((S=e((C=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,r(e,"player",S,a(e)),r(e,"camera",D,a(e)),r(e,"normalPlatformPrefab",K,a(e)),r(e,"spikePlatformPrefab",z,a(e)),r(e,"normminDistance",N,a(e)),r(e,"normmaxDistance",X,a(e)),r(e,"spikeminDistance",A,a(e)),r(e,"spikemaxDistance",I,a(e)),r(e,"jumpPowerFactor",Y,a(e)),r(e,"gravity",F,a(e)),r(e,"leftBoundaryX",j,a(e)),r(e,"cameraOffsetX",G,a(e)),r(e,"cameraOffsetY",M,a(e)),e._touchStartTime=0,e._charging=!1,e._velocityX=0,e._velocityY=0,e._isJumping=!1,e._currentPlatform=null,e._nextPlatform=null,e._nextKind=_.Normal,e._cameraBaseY=0,e}i(e,t);var o=e.prototype;return o.onLoad=function(){m.on(f.EventType.TOUCH_START,this.onTouchStart,this),m.on(f.EventType.TOUCH_END,this.onTouchEnd,this)},o.start=function(){this.camera&&(this._cameraBaseY=this.camera.node.position.y),this.setupExistingPlatforms()},o.getPlatformsInScene=function(){var t=this;return this.node.children.filter((function(e){return e!==t.player&&e.getComponent(P)}))},o.findNextPlatform=function(t){var e=this.getPlatformsInScene().filter((function(e){return e.position.x>t}));return 0===e.length?null:(e.sort((function(t,e){return t.position.x-e.position.x})),e[0]||null)},o.getNextPlatformPos=function(t){var e=h.randomRangeInt(this.normminDistance,this.normmaxDistance);return new p(t.x+e,-40,0)},o.getRightmostPlatform=function(){var t=this.getPlatformsInScene();return 0===t.length?null:t.reduce((function(t,e){return e.position.x>t.position.x?e:t}))},o.getPlatformWidth=function(t){var e=t.getComponent(g);return e?e.width*t.scale.x:160},o.spawnAdjacentPlatform=function(t){var e=this.getRightmostPlatform();if(!e)return console.warn("[GameManager] 无基准平台，无法紧贴生成"),null;var i=t===_.Normal?this.normalPlatformPrefab:this.spikePlatformPrefab;if(!i)return console.warn("[GameManager] 缺少预制: "+_[t]+"平台"),null;var n=d(i);this.node.addChild(n);var r=t===_.Normal?h.randomRangeInt(this.normminDistance,this.normmaxDistance+1):h.randomRangeInt(this.spikeminDistance,this.spikemaxDistance+1),a=n.getComponent(g);if(a&&a.width>0){var o=r/a.width;n.setScale(o,1,1)}else{var l=r/160;n.setScale(l,1,1)}var s=this.getPlatformWidth(e),c=this.getPlatformWidth(n),u=e.position.x+.5*(s+c);return n.setPosition(u,-40,0),n.getComponent(P).kind=t,n},o.nextKindAndToggle=function(){var t=this._nextKind;return this._nextKind=this._nextKind===_.Normal?_.Spike:_.Normal,t},o.setupExistingPlatforms=function(){var t,e,i=this.getPlatformsInScene().sort((function(t,e){return t.position.x-e.position.x}));if(0!==i.length){if(this._currentPlatform=i[0],this._nextPlatform=i.length>1?i[1]:null,this._nextPlatform){var n,r=null==(n=this._nextPlatform.getComponent(P))?void 0:n.kind;void 0!==r&&(this._nextKind=r===_.Normal?_.Spike:_.Normal)}else if(this._currentPlatform){var a,o=null==(a=this._currentPlatform.getComponent(P))?void 0:a.kind;void 0!==o&&(this._nextKind=o===_.Normal?_.Spike:_.Normal)}if(!this._nextPlatform){var l=this.nextKindAndToggle();this._nextPlatform=this.spawnAdjacentPlatform(l)}this.updateCamera(),console.log("[GameManager] 已读取场景平台: current=",null==(t=this._currentPlatform)?void 0:t.position.x,"next=",null==(e=this._nextPlatform)?void 0:e.position.x,"nextKindToGenerate=",this._nextKind)}else console.warn("[GameManager] 场景没有已有平台，考虑手动拖入或恢复 spawnInitialPlatforms()")},o.onTouchStart=function(t){var e;if(this.player&&!this._isJumping){this._charging=!0,this._touchStartTime=performance.now();var i=null==(e=this._currentPlatform)||null==(e=e.getComponent(P))?void 0:e.kind;console.log("[TouchStart] begin charge. curKind=",i)}},o.onTouchEnd=function(t){var e;if(this.player&&this._charging){var i=performance.now()-this._touchStartTime;if(this._charging=!1,!this._isJumping){if(!this._nextPlatform&&this._currentPlatform){console.warn("[TouchEnd] _nextPlatform 缺失，尝试兜底生成");var n=this.nextKindAndToggle(),r=this.spawnAdjacentPlatform(n);if(!r)return void console.error("[TouchEnd] 兜底生成失败，无法跳跃");this._nextPlatform=r,this.updateCamera()}if(this._nextPlatform){var a=h.clamp(i/550,.25,2.2)*this.jumpPowerFactor,o=this.player.position.x,l=this._nextPlatform.position.x>o?1:-1;this._velocityX=l*a*520,this._velocityY=980*a,this._isJumping=!0,console.log("[Jump] power=",a.toFixed(2),"targetKind=",null==(e=this._nextPlatform.getComponent(P))?void 0:e.kind)}}}},o.update=function(t){if(this._charging&&this.player){var e=1-.55*h.clamp((performance.now()-this._touchStartTime)/1400,0,.55);this.player.setScale(1,e,1)}else!this._isJumping&&this.player&&this.player.setScale(1,1,1);if(this._isJumping&&this.player){this._velocityY+=this.gravity*t;var i=this.player.position,n=new p(i.x+this._velocityX*t,i.y+this._velocityY*t,0);n.x<this.leftBoundaryX&&(n.x=this.leftBoundaryX,this._velocityX<0&&(this._velocityX=0)),n.y<=0?(n.y=0,this.player.setPosition(n),this._isJumping=!1,this._velocityX=0,this._velocityY=0,this.checkLanding()):this.player.setPosition(n)}this.updateCamera(),this.ensureFuturePlatform()},o.checkLanding=function(){if(this.player){for(var t,e=this.player.position.x,i=this.getPlatformsInScene(),r=null,a=1/0,o=n(i);!(t=o()).done;){var l=t.value,s=l.getComponent(g),c=s?s.width*l.scale.x*.5:80,u=Math.abs(e-l.position.x);u<=c&&u<a&&(r=l,a=u)}if(r){var m=r.getComponent(P);if(m&&m.kind===_.Spike){this._currentPlatform=r,this._velocityX=-450,this._velocityY=900,this._isJumping=!0,console.log("[Landing] Spike bounce left x=",r.position.x.toFixed(1));var f=this.nextKindAndToggle(),h=this.spawnAdjacentPlatform(f);h&&(this._nextPlatform=h,this.updateCamera())}else{this._currentPlatform=r;var p,d=this.nextKindAndToggle(),x=this.spawnAdjacentPlatform(d);if(x)this._nextPlatform=x,this.updateCamera(),console.log("[Landing] Normal landed -> generated next",null==(p=x.getComponent(P))?void 0:p.kind)}}else console.log("[Landing] miss all platforms pX=",e.toFixed(1))}},o.updateCamera=function(){if(this.camera&&this.player){var t=this.camera.node,e=this.player.position.x+this.cameraOffsetX,i=t.position,n=i.x+.15*(e-i.x),r=this._cameraBaseY+this.cameraOffsetY;t.setPosition(n,r,i.z)}},o.ensureFuturePlatform=function(){if(this.player){var t=this.player.position.x+2e3,e=this.getRightmostPlatform();if(e)for(;;){if(e.position.x+.5*this.getPlatformWidth(e)>=t)break;var i=this.nextKindAndToggle(),n=this.spawnAdjacentPlatform(i);if(!n)break;e=n,this._nextPlatform=n,console.log("[FutureGen] 紧贴补平台 kind=",_[i],"x=",n.position.x)}}},e}(x)).prototype,"player",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(C.prototype,"camera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(C.prototype,"normalPlatformPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(C.prototype,"spikePlatformPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(C.prototype,"normminDistance",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),X=e(C.prototype,"normmaxDistance",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),A=e(C.prototype,"spikeminDistance",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),I=e(C.prototype,"spikemaxDistance",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),Y=e(C.prototype,"jumpPowerFactor",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),F=e(C.prototype,"gravity",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-2200}}),j=e(C.prototype,"leftBoundaryX",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),G=e(C.prototype,"cameraOffsetX",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),M=e(C.prototype,"cameraOffsetY",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-40}}),k=C))||k));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BackgroundScroller.ts","./GameManager.ts","./PlatformType.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlatformType.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,t,n,i,o,a,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,t=r.inheritsLoose,n=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){o=r.cclegacy,a=r._decorator,l=r.Component}],execute:function(){var c,p,u,s,f;o._RF.push({},"be156r4ERBC2ZtP+OblATa0","PlatformType",void 0);var y=a.ccclass,m=a.property,d=r("PlatformKind",function(r){return r[r.Normal=0]="Normal",r[r.Spike=1]="Spike",r}({}));r("PlatformType",(c=y("PlatformType"),p=m({type:d}),c((f=e((s=function(r){function e(){for(var e,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=r.call.apply(r,[this].concat(o))||this,n(e,"kind",f,i(e)),e}return t(e,r),e}(l)).prototype,"kind",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.Normal}}),u=s))||u));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});