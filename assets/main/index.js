System.register("chunks:///_virtual/BackgroundScroller.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,o,r,n,e,s,a,c,u,l,d;return{setters:[function(i){t=i.applyDecoratedDescriptor,o=i.inheritsLoose,r=i.createForOfIteratorHelperLoose,n=i.initializerDefineProperty,e=i.assertThisInitialized},function(i){s=i.cclegacy,a=i._decorator,c=i.Node,u=i.Camera,l=i.UITransform,d=i.Component}],execute:function(){var h,p,g,f,b,k,v;s._RF.push({},"94c39Y9E9JOxb3L914uU7Sp","BackgroundScroller",void 0);var _=a.ccclass,w=a.property;i("BackgroundScroller",(h=_("BackgroundScroller"),p=w([c]),g=w(u),h((k=t((b=function(i){function t(){for(var t,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return t=i.call.apply(i,[this].concat(r))||this,n(t,"backgrounds",k,e(t)),n(t,"camera",v,e(t)),t._width=0,t._initialized=!1,t}o(t,i);var s=t.prototype;return s.start=function(){this.initBackgrounds()},s.initBackgrounds=function(){if(this.backgrounds.length<2)console.warn("[BackgroundScroller] backgrounds 少于2，无法循环滚动");else{var i=this.backgrounds[0].getComponent(l);this._width=i?i.width*this.backgrounds[0].scale.x:1920;for(var t=0;t<this.backgrounds.length;t++)this.backgrounds[t].setPosition(t*this._width,0,0);this._initialized=!0}},s.update=function(i){if(this._initialized&&this.camera){for(var t,o=this.camera.node.position.x,n=this.backgrounds[0],e=this.backgrounds[0],s=r(this.backgrounds);!(t=s()).done;){var a=t.value;a.position.x>n.position.x&&(n=a),a.position.x<e.position.x&&(e=a)}for(var c,u=r(this.backgrounds);!(c=u()).done;){var l=c.value;o-l.position.x>this._width?(l.setPosition(n.position.x+this._width,l.position.y,l.position.z),n=l):l.position.x-o>this._width&&(l.setPosition(e.position.x-this._width,l.position.y,l.position.z),e=l)}}},t}(d)).prototype,"backgrounds",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=t(b.prototype,"camera",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=b))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlatformType.ts"],(function(t){var i,e,n,r,o,a,s,l,u,f,h,c,p,m,g,d,b,v,_,y;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,l=t.Node,u=t.Camera,f=t.Prefab,h=t.Label,c=t.input,p=t.Input,m=t.math,g=t.Vec3,d=t.UITransform,b=t.instantiate,v=t.Component},function(t){_=t.PlatformType,y=t.PlatformKind}],execute:function(){var x,P,k,C,L,w,T,S,X,z,A,O,N,B,Y,D,F,K,E,I,M,j,G,J,R,V,H,Q,U,W,q,Z,$,tt;a._RF.push({},"e0c100uNslNKYCv+TlfkIUn","GameManager",void 0);var it=s.ccclass,et=s.property;t("GameManager",(x=it("GameManager"),P=et(l),k=et(u),C=et(f),L=et(f),w=et(h),T=et(h),S=et(h),X=et(h),x((O=i((A=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return i=t.call.apply(t,[this].concat(n))||this,r(i,"player",O,o(i)),r(i,"camera",N,o(i)),r(i,"normalPlatformPrefab",B,o(i)),r(i,"spikePlatformPrefab",Y,o(i)),r(i,"normminDistance",D,o(i)),r(i,"normmaxDistance",F,o(i)),r(i,"spikeminDistance",K,o(i)),r(i,"spikemaxDistance",E,o(i)),r(i,"jumpPowerFactor",I,o(i)),r(i,"gravity",M,o(i)),r(i,"leftBoundaryX",j,o(i)),r(i,"cameraOffsetX",G,o(i)),r(i,"cameraOffsetY",J,o(i)),r(i,"playerXLabel",R,o(i)),r(i,"labelOffsetX",V,o(i)),r(i,"labelOffsetY",H,o(i)),r(i,"victoryLabel",Q,o(i)),r(i,"spikeCountLabel",U,o(i)),r(i,"spikeLabelOffsetX",W,o(i)),r(i,"spikeLabelOffsetY",q,o(i)),r(i,"spikesLeftLabel",Z,o(i)),r(i,"spikesLeftLabelOffsetX",$,o(i)),r(i,"spikesLeftLabelOffsetY",tt,o(i)),i._touchStartTime=0,i._charging=!1,i._velocityX=0,i._velocityY=0,i._isJumping=!1,i._currentPlatform=null,i._nextPlatform=null,i._nextKind=y.Normal,i._cameraBaseY=0,i._spikeChainCount=0,i._autoBounceQueue=[],i._inAutoChain=!1,i._normalCount=0,i._win=!1,i._winTriggered=!1,i}e(i,t);var a=i.prototype;return a.onLoad=function(){c.on(p.EventType.TOUCH_START,this.onTouchStart,this),c.on(p.EventType.TOUCH_END,this.onTouchEnd,this)},a.start=function(){this.camera&&(this._cameraBaseY=this.camera.node.position.y),this.setupExistingPlatforms()},a.getPlatformsInScene=function(){var t=this;return this.node.children.filter((function(i){return i!==t.player&&i.getComponent(_)}))},a.findNextPlatform=function(t){var i=this.getPlatformsInScene().filter((function(i){return i.position.x>t}));return 0===i.length?null:(i.sort((function(t,i){return t.position.x-i.position.x})),i[0]||null)},a.getNextPlatformPos=function(t){var i=m.randomRangeInt(this.normminDistance,this.normmaxDistance);return new g(t.x+i,-40,0)},a.getRightmostPlatform=function(){var t=this.getPlatformsInScene();return 0===t.length?null:t.reduce((function(t,i){return i.position.x>t.position.x?i:t}))},a.getPlatformWidth=function(t){var i=t.getComponent(d);return i?i.width*t.scale.x:160},a.spawnAdjacentPlatform=function(t){if(this._win)return null;if(t===y.Normal&&this._normalCount>=51)return null;if(this._normalCount>=51)return null;var i=this.getRightmostPlatform();if(!i)return console.warn("[GameManager] 无基准平台，无法紧贴生成"),null;var e=t===y.Normal?this.normalPlatformPrefab:this.spikePlatformPrefab;if(!e)return console.warn("[GameManager] 缺少预制: "+y[t]+"平台"),null;var n,r=b(e);if(this.node.addChild(r),t===y.Normal){var o=this._normalCount+1,a=m.randomRangeInt(this.normminDistance,this.normmaxDistance+1);n=a,o>=31&&o<=40&&(n=Math.max(40,Math.floor(.5*a)),console.log("[NormalSize] 第"+o+"个Normal平台长度减半 原宽="+a+" 新宽="+n))}else n=m.randomRangeInt(this.spikeminDistance,this.spikemaxDistance+1);var s=r.getComponent(d);s&&s.width>0?r.setScale(n/s.width,1,1):r.setScale(n/160,1,1);var l=this.getPlatformWidth(i),u=this.getPlatformWidth(r),f=i.position.x+.5*(l+u);return r.setPosition(f,-40,0),r.getComponent(_).kind=t,t===y.Normal&&(this._normalCount++,51===this._normalCount&&console.log("[Limit] 已生成第51个Normal，停止后续平台生成")),r},a.nextKindAndToggle=function(){var t=this._nextKind;return this._nextKind=this._nextKind===y.Normal?y.Spike:y.Normal,t},a.setupExistingPlatforms=function(){var t,i,e=this.getPlatformsInScene().sort((function(t,i){return t.position.x-i.position.x}));if(0!==e.length){if(this._normalCount=e.filter((function(t){var i;return(null==(i=t.getComponent(_))?void 0:i.kind)===y.Normal})).length,this._currentPlatform=e[0],this._nextPlatform=e.length>1?e[1]:null,this._nextPlatform){var n,r=null==(n=this._nextPlatform.getComponent(_))?void 0:n.kind;void 0!==r&&(this._nextKind=r===y.Normal?y.Spike:y.Normal)}else if(this._currentPlatform){var o,a=null==(o=this._currentPlatform.getComponent(_))?void 0:o.kind;void 0!==a&&(this._nextKind=a===y.Normal?y.Spike:y.Normal)}if(!this._nextPlatform){var s=this.nextKindAndToggle();this._nextPlatform=this.spawnAdjacentPlatform(s)}this.updateCamera(),console.log("[GameManager] 已读取场景平台: current=",null==(t=this._currentPlatform)?void 0:t.position.x,"next=",null==(i=this._nextPlatform)?void 0:i.position.x,"nextKindToGenerate=",this._nextKind,"已有Normal数量=",this._normalCount)}else console.warn("[GameManager] 场景没有已有平台，考虑手动拖入或恢复 spawnInitialPlatforms()")},a.onTouchStart=function(t){var i;if(this.player&&!this._isJumping){this._charging=!0,this._touchStartTime=performance.now();var e=null==(i=this._currentPlatform)||null==(i=i.getComponent(_))?void 0:i.kind;console.log("[TouchStart] begin charge. curKind=",e)}},a.onTouchEnd=function(t){var i;if(this.player&&this._charging){var e=performance.now()-this._touchStartTime;if(this._charging=!1,!this._isJumping){if(!this._nextPlatform&&this._currentPlatform){console.warn("[TouchEnd] _nextPlatform 缺失，尝试兜底生成");var n=this.nextKindAndToggle(),r=this.spawnAdjacentPlatform(n);if(!r)return void console.error("[TouchEnd] 兜底生成失败，无法跳跃");this._nextPlatform=r,this.updateCamera()}if(this._nextPlatform){var o=m.clamp(e/550,.25,2.2)*this.jumpPowerFactor,a=this.player.position.x,s=this._nextPlatform.position.x>a?1:-1;this._velocityX=s*o*520,this._velocityY=980*o,this._isJumping=!0,console.log("[Jump] power=",o.toFixed(2),"targetKind=",null==(i=this._nextPlatform.getComponent(_))?void 0:i.kind)}}}},a.update=function(t){if(this._charging&&this.player){var i=1-.55*m.clamp((performance.now()-this._touchStartTime)/1400,0,.55);this.player.setScale(1,i,1)}else!this._isJumping&&this.player&&this.player.setScale(1,1,1);if(this._isJumping&&this.player){this._velocityY+=this.gravity*t;var e=this.player.position,n=new g(e.x+this._velocityX*t,e.y+this._velocityY*t,0);n.x<this.leftBoundaryX&&(n.x=this.leftBoundaryX,this._velocityX<0&&(this._velocityX=0)),n.y<=0?(n.y=0,this.player.setPosition(n),this._isJumping=!1,this._velocityX=0,this._velocityY=0,this.checkLanding()):this.player.setPosition(n)}this.updateCamera(),this.ensureFuturePlatform(),this.updatePlayerXLabel(),this.updateSpikeCountLabel(),this.updateSpikesLeftLabel(),this.checkVictory()},a.updatePlayerXLabel=function(){if(this.playerXLabel&&this.player){var t=this.player.position.x/40;if(this.playerXLabel.string="当前所在: "+t.toFixed(1)+" m",this.camera){var i=this.camera.node.position;this.playerXLabel.node.setPosition(i.x+this.labelOffsetX,i.y+this.labelOffsetY,0)}}},a.updateSpikeCountLabel=function(){if(this.spikeCountLabel&&(this.spikeCountLabel.string="已碰地刺次数: "+this._spikeChainCount,this.camera)){var t=this.camera.node.position;this.spikeCountLabel.node.setPosition(t.x+this.spikeLabelOffsetX,t.y+this.spikeLabelOffsetY,0)}},a.updateSpikesLeftLabel=function(){if(this.spikesLeftLabel&&this.player){var t=this.player.position.x,i=this.getPlatformsInScene().filter((function(i){var e;return i.position.x<t&&(null==(e=i.getComponent(_))?void 0:e.kind)===y.Spike})).length;if(this.spikesLeftLabel.string="已跃地刺数："+i,this.camera){var e=this.camera.node.position;this.spikesLeftLabel.node.setPosition(e.x+this.spikesLeftLabelOffsetX,e.y+this.spikesLeftLabelOffsetY,0)}}},a.checkLanding=function(){if(this.player){for(var t,i=this.player.position.x,e=this.getPlatformsInScene(),r=null,o=1/0,a=n(e);!(t=a()).done;){var s=t.value,l=s.getComponent(d),u=l?l.width*s.scale.x*.5:80,f=Math.abs(i-s.position.x);f<=u&&f<o&&(r=s,o=f)}if(r){var h=r.getComponent(_);if(this._inAutoChain){if(this._autoBounceQueue.length>0){var c=this._autoBounceQueue.shift();if(c)return void this.startAutoBounceTo(c)}if(this._inAutoChain=!1,h&&h.kind===y.Spike){var p=this.buildSpikeBounceChain(r,e,this._spikeChainCount);if(p.length>0){var m=p.shift();return this._autoBounceQueue=p,this._inAutoChain=!0,this._spikeChainCount++,void this.startAutoBounceTo(m)}return void this.simpleSpikeBounceFallback(r,e)}this._currentPlatform=r;var g=this.nextKindAndToggle(),b=this.spawnAdjacentPlatform(g);return b&&(this._nextPlatform=b,this.updateCamera()),void(this._winTriggered&&!this._win&&this.finalizeVictory())}if(h&&h.kind===y.Spike){this._currentPlatform=r;var v=this.buildSpikeBounceChain(r,e,this._spikeChainCount);if(0===v.length)this.simpleSpikeBounceFallback(r,e);else{var x=v.shift();this._autoBounceQueue=v,this._inAutoChain=!0,this._spikeChainCount++,this.startAutoBounceTo(x)}var P=this.nextKindAndToggle(),k=this.spawnAdjacentPlatform(P);k&&(this._nextPlatform=k,this.updateCamera())}else{this._currentPlatform=r;var C,L=this.nextKindAndToggle(),w=this.spawnAdjacentPlatform(L);if(w)this._nextPlatform=w,this.updateCamera(),console.log("[Landing] Normal landed -> generated next",null==(C=w.getComponent(_))?void 0:C.kind);this._winTriggered&&!this._win&&this.finalizeVictory()}}else console.log("[Landing] miss all platforms pX=",i.toFixed(1))}},a.buildSpikeBounceChain=function(t,i,e){var n=[];if(0===e){var r=this.findLeftExisting(t,i,y.Normal);return r&&n.push(r),n}var o=this.findLeftAll(t,i,y.Spike).slice(0,e);if(0===o.length)return[];if(n.push.apply(n,o),o.length===e){var a=o[o.length-1],s=this.findLeftExisting(a,i,y.Normal);s&&n.push(s)}return n},a.findLeftExisting=function(t,i,e){var n=t.position.x;return i.filter((function(t){var i;return t.position.x<n&&(null==(i=t.getComponent(_))?void 0:i.kind)===e})).sort((function(t,i){return i.position.x-t.position.x}))[0]||null},a.findLeftAll=function(t,i,e){var n=t.position.x;return i.filter((function(t){var i;return t.position.x<n&&(null==(i=t.getComponent(_))?void 0:i.kind)===e})).sort((function(t,i){return i.position.x-t.position.x}))},a.updateCamera=function(){if(this.camera&&this.player){var t=this.camera.node,i=this.player.position.x+this.cameraOffsetX,e=t.position,n=e.x+.15*(i-e.x),r=this._cameraBaseY+this.cameraOffsetY;t.setPosition(n,r,e.z)}},a.ensureFuturePlatform=function(){if(this.player&&!(this._win||this._normalCount>=51)){var t=this.player.position.x+2e3,i=this.getRightmostPlatform();if(i)for(;;){if(i.position.x+.5*this.getPlatformWidth(i)>=t)break;var e=this.nextKindAndToggle(),n=this.spawnAdjacentPlatform(e);if(!n)break;i=n,this._nextPlatform=n,console.log("[FutureGen] 紧贴补平台 kind=",y[e],"x=",n.position.x)}}},a.checkVictory=function(){if(!this._win&&!this._winTriggered&&this.player){var t=this.player.position.x;this.getPlatformsInScene().filter((function(i){var e;return i.position.x<t&&(null==(e=i.getComponent(_))?void 0:e.kind)===y.Spike})).length>=40&&(this._winTriggered=!0,console.log("[VictoryTrigger] 条件已满足(>=40 Spike)，等待落到 Normal 显示胜利"))}},a.finalizeVictory=function(){if(!this._win&&(this._win=!0,this._autoBounceQueue.length=0,this._inAutoChain=!1,c.off(p.EventType.TOUCH_START,this.onTouchStart,this),c.off(p.EventType.TOUCH_END,this.onTouchEnd,this),console.log("[Victory] 已落到 Normal，显示胜利并停止输入"),this.victoryLabel&&this.camera)){this.victoryLabel.string="游戏胜利";var t=this.camera.node.position;this.victoryLabel.node.setPosition(t.x-40,t.y,0)}},a.startAutoBounceTo=function(t){if(this.player){var i=this.player.position.x,e=t.position.x,n=i-e,r=-1800/this.gravity,o=-450;if(r>.05){o=-n/r;var a=Math.abs(o);a>1600&&(o=-1600),a<150&&(o=-150)}this._velocityX=o,this._velocityY=900,this._isJumping=!0,console.log("[AutoBounce] to",e.toFixed(1),"vx=",o.toFixed(1))}},a.simpleSpikeBounceFallback=function(t,i){var e=t.position.x,n=i.filter((function(t){var i;return t.position.x<e&&(null==(i=t.getComponent(_))?void 0:i.kind)===y.Spike})).sort((function(t,i){return i.position.x-t.position.x}))[0],r=-450;if(n){var o=e-n.position.x,a=-1800/this.gravity;if(a>.05){r=-o/a;var s=Math.abs(r);s>1400&&(r=-1400),s<150&&(r=-150)}}this._velocityX=r,this._velocityY=900,this._isJumping=!0,console.log("[SpikeBounceFallback] vx=",r.toFixed(1))},i}(v)).prototype,"player",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(A.prototype,"camera",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=i(A.prototype,"normalPlatformPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=i(A.prototype,"spikePlatformPrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(A.prototype,"normminDistance",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),F=i(A.prototype,"normmaxDistance",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),K=i(A.prototype,"spikeminDistance",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),E=i(A.prototype,"spikemaxDistance",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),I=i(A.prototype,"jumpPowerFactor",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M=i(A.prototype,"gravity",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-2200}}),j=i(A.prototype,"leftBoundaryX",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),G=i(A.prototype,"cameraOffsetX",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),J=i(A.prototype,"cameraOffsetY",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-40}}),R=i(A.prototype,"playerXLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=i(A.prototype,"labelOffsetX",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),H=i(A.prototype,"labelOffsetY",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),Q=i(A.prototype,"victoryLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(A.prototype,"spikeCountLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=i(A.prototype,"spikeLabelOffsetX",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),q=i(A.prototype,"spikeLabelOffsetY",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),Z=i(A.prototype,"spikesLeftLabel",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=i(A.prototype,"spikesLeftLabelOffsetX",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),tt=i(A.prototype,"spikesLeftLabelOffsetY",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),z=A))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BackgroundScroller.ts","./GameManager.ts","./PlatformType.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlatformType.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,t,n,i,o,a,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,t=r.inheritsLoose,n=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){o=r.cclegacy,a=r._decorator,l=r.Component}],execute:function(){var c,p,u,s,f;o._RF.push({},"be156r4ERBC2ZtP+OblATa0","PlatformType",void 0);var y=a.ccclass,m=a.property,d=r("PlatformKind",function(r){return r[r.Normal=0]="Normal",r[r.Spike=1]="Spike",r}({}));r("PlatformType",(c=y("PlatformType"),p=m({type:d}),c((f=e((s=function(r){function e(){for(var e,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=r.call.apply(r,[this].concat(o))||this,n(e,"kind",f,i(e)),e}return t(e,r),e}(l)).prototype,"kind",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.Normal}}),u=s))||u));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});