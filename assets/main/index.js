System.register("chunks:///_virtual/BackgroundScroller.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,o,r,n,e,s,a,c,u,l,d;return{setters:[function(i){t=i.applyDecoratedDescriptor,o=i.inheritsLoose,r=i.createForOfIteratorHelperLoose,n=i.initializerDefineProperty,e=i.assertThisInitialized},function(i){s=i.cclegacy,a=i._decorator,c=i.Node,u=i.Camera,l=i.UITransform,d=i.Component}],execute:function(){var h,p,g,f,b,k,v;s._RF.push({},"94c39Y9E9JOxb3L914uU7Sp","BackgroundScroller",void 0);var _=a.ccclass,w=a.property;i("BackgroundScroller",(h=_("BackgroundScroller"),p=w([c]),g=w(u),h((k=t((b=function(i){function t(){for(var t,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return t=i.call.apply(i,[this].concat(r))||this,n(t,"backgrounds",k,e(t)),n(t,"camera",v,e(t)),t._width=0,t._initialized=!1,t}o(t,i);var s=t.prototype;return s.start=function(){this.initBackgrounds()},s.initBackgrounds=function(){if(this.backgrounds.length<2)console.warn("[BackgroundScroller] backgrounds 少于2，无法循环滚动");else{var i=this.backgrounds[0].getComponent(l);this._width=i?i.width*this.backgrounds[0].scale.x:1920;for(var t=0;t<this.backgrounds.length;t++)this.backgrounds[t].setPosition(t*this._width,0,0);this._initialized=!0}},s.update=function(i){if(this._initialized&&this.camera){for(var t,o=this.camera.node.position.x,n=this.backgrounds[0],e=this.backgrounds[0],s=r(this.backgrounds);!(t=s()).done;){var a=t.value;a.position.x>n.position.x&&(n=a),a.position.x<e.position.x&&(e=a)}for(var c,u=r(this.backgrounds);!(c=u()).done;){var l=c.value;o-l.position.x>this._width?(l.setPosition(n.position.x+this._width,l.position.y,l.position.z),n=l):l.position.x-o>this._width&&(l.setPosition(e.position.x-this._width,l.position.y,l.position.z),e=l)}}},t}(d)).prototype,"backgrounds",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=t(b.prototype,"camera",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=b))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlatformType.ts"],(function(t){var e,i,n,r,a,o,l,s,u,f,c,m,h,p,g,d,x,y,v,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,r=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,s=t.Node,u=t.Camera,f=t.Prefab,c=t.Label,m=t.input,h=t.Input,p=t.math,g=t.Vec3,d=t.UITransform,x=t.instantiate,y=t.Component},function(t){v=t.PlatformType,P=t.PlatformKind}],execute:function(){var b,_,w,k,T,S,X,C,z,D,K,L,F,N,Y,O,A,I,M,j,B,G,E,J;o._RF.push({},"e0c100uNslNKYCv+TlfkIUn","GameManager",void 0);var R=l.ccclass,H=l.property;t("GameManager",(b=R("GameManager"),_=H(s),w=H(u),k=H(f),T=H(f),S=H(c),b((z=e((C=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,r(e,"player",z,a(e)),r(e,"camera",D,a(e)),r(e,"normalPlatformPrefab",K,a(e)),r(e,"spikePlatformPrefab",L,a(e)),r(e,"normminDistance",F,a(e)),r(e,"normmaxDistance",N,a(e)),r(e,"spikeminDistance",Y,a(e)),r(e,"spikemaxDistance",O,a(e)),r(e,"jumpPowerFactor",A,a(e)),r(e,"gravity",I,a(e)),r(e,"leftBoundaryX",M,a(e)),r(e,"cameraOffsetX",j,a(e)),r(e,"cameraOffsetY",B,a(e)),r(e,"playerXLabel",G,a(e)),r(e,"labelOffsetX",E,a(e)),r(e,"labelOffsetY",J,a(e)),e._touchStartTime=0,e._charging=!1,e._velocityX=0,e._velocityY=0,e._isJumping=!1,e._currentPlatform=null,e._nextPlatform=null,e._nextKind=P.Normal,e._cameraBaseY=0,e}i(e,t);var o=e.prototype;return o.onLoad=function(){m.on(h.EventType.TOUCH_START,this.onTouchStart,this),m.on(h.EventType.TOUCH_END,this.onTouchEnd,this)},o.start=function(){this.camera&&(this._cameraBaseY=this.camera.node.position.y),this.setupExistingPlatforms()},o.getPlatformsInScene=function(){var t=this;return this.node.children.filter((function(e){return e!==t.player&&e.getComponent(v)}))},o.findNextPlatform=function(t){var e=this.getPlatformsInScene().filter((function(e){return e.position.x>t}));return 0===e.length?null:(e.sort((function(t,e){return t.position.x-e.position.x})),e[0]||null)},o.getNextPlatformPos=function(t){var e=p.randomRangeInt(this.normminDistance,this.normmaxDistance);return new g(t.x+e,-40,0)},o.getRightmostPlatform=function(){var t=this.getPlatformsInScene();return 0===t.length?null:t.reduce((function(t,e){return e.position.x>t.position.x?e:t}))},o.getPlatformWidth=function(t){var e=t.getComponent(d);return e?e.width*t.scale.x:160},o.spawnAdjacentPlatform=function(t){var e=this.getRightmostPlatform();if(!e)return console.warn("[GameManager] 无基准平台，无法紧贴生成"),null;var i=t===P.Normal?this.normalPlatformPrefab:this.spikePlatformPrefab;if(!i)return console.warn("[GameManager] 缺少预制: "+P[t]+"平台"),null;var n=x(i);this.node.addChild(n);var r=t===P.Normal?p.randomRangeInt(this.normminDistance,this.normmaxDistance+1):p.randomRangeInt(this.spikeminDistance,this.spikemaxDistance+1),a=n.getComponent(d);if(a&&a.width>0){var o=r/a.width;n.setScale(o,1,1)}else{var l=r/160;n.setScale(l,1,1)}var s=this.getPlatformWidth(e),u=this.getPlatformWidth(n),f=e.position.x+.5*(s+u);return n.setPosition(f,-40,0),n.getComponent(v).kind=t,n},o.nextKindAndToggle=function(){var t=this._nextKind;return this._nextKind=this._nextKind===P.Normal?P.Spike:P.Normal,t},o.setupExistingPlatforms=function(){var t,e,i=this.getPlatformsInScene().sort((function(t,e){return t.position.x-e.position.x}));if(0!==i.length){if(this._currentPlatform=i[0],this._nextPlatform=i.length>1?i[1]:null,this._nextPlatform){var n,r=null==(n=this._nextPlatform.getComponent(v))?void 0:n.kind;void 0!==r&&(this._nextKind=r===P.Normal?P.Spike:P.Normal)}else if(this._currentPlatform){var a,o=null==(a=this._currentPlatform.getComponent(v))?void 0:a.kind;void 0!==o&&(this._nextKind=o===P.Normal?P.Spike:P.Normal)}if(!this._nextPlatform){var l=this.nextKindAndToggle();this._nextPlatform=this.spawnAdjacentPlatform(l)}this.updateCamera(),console.log("[GameManager] 已读取场景平台: current=",null==(t=this._currentPlatform)?void 0:t.position.x,"next=",null==(e=this._nextPlatform)?void 0:e.position.x,"nextKindToGenerate=",this._nextKind)}else console.warn("[GameManager] 场景没有已有平台，考虑手动拖入或恢复 spawnInitialPlatforms()")},o.onTouchStart=function(t){var e;if(this.player&&!this._isJumping){this._charging=!0,this._touchStartTime=performance.now();var i=null==(e=this._currentPlatform)||null==(e=e.getComponent(v))?void 0:e.kind;console.log("[TouchStart] begin charge. curKind=",i)}},o.onTouchEnd=function(t){var e;if(this.player&&this._charging){var i=performance.now()-this._touchStartTime;if(this._charging=!1,!this._isJumping){if(!this._nextPlatform&&this._currentPlatform){console.warn("[TouchEnd] _nextPlatform 缺失，尝试兜底生成");var n=this.nextKindAndToggle(),r=this.spawnAdjacentPlatform(n);if(!r)return void console.error("[TouchEnd] 兜底生成失败，无法跳跃");this._nextPlatform=r,this.updateCamera()}if(this._nextPlatform){var a=p.clamp(i/550,.25,2.2)*this.jumpPowerFactor,o=this.player.position.x,l=this._nextPlatform.position.x>o?1:-1;this._velocityX=l*a*520,this._velocityY=980*a,this._isJumping=!0,console.log("[Jump] power=",a.toFixed(2),"targetKind=",null==(e=this._nextPlatform.getComponent(v))?void 0:e.kind)}}}},o.update=function(t){if(this._charging&&this.player){var e=1-.55*p.clamp((performance.now()-this._touchStartTime)/1400,0,.55);this.player.setScale(1,e,1)}else!this._isJumping&&this.player&&this.player.setScale(1,1,1);if(this._isJumping&&this.player){this._velocityY+=this.gravity*t;var i=this.player.position,n=new g(i.x+this._velocityX*t,i.y+this._velocityY*t,0);n.x<this.leftBoundaryX&&(n.x=this.leftBoundaryX,this._velocityX<0&&(this._velocityX=0)),n.y<=0?(n.y=0,this.player.setPosition(n),this._isJumping=!1,this._velocityX=0,this._velocityY=0,this.checkLanding()):this.player.setPosition(n)}this.updateCamera(),this.ensureFuturePlatform(),this.updatePlayerXLabel()},o.updatePlayerXLabel=function(){if(this.playerXLabel&&this.player){var t=this.player.position.x/40;if(this.playerXLabel.string="当前所在: "+t.toFixed(1)+" m",this.camera){var e=this.camera.node.position;this.playerXLabel.node.setPosition(e.x+this.labelOffsetX,e.y+this.labelOffsetY,0)}}},o.checkLanding=function(){if(this.player){for(var t,e=this.player.position.x,i=this.getPlatformsInScene(),r=null,a=1/0,o=n(i);!(t=o()).done;){var l=t.value,s=l.getComponent(d),u=s?s.width*l.scale.x*.5:80,f=Math.abs(e-l.position.x);f<=u&&f<a&&(r=l,a=f)}if(r){var c=r.getComponent(v);if(c&&c.kind===P.Spike){this._currentPlatform=r;var m=r.position.x,h=i.filter((function(t){var e;return t!==r&&t.position.x<m&&(null==(e=t.getComponent(v))?void 0:e.kind)===P.Spike})).sort((function(t,e){return e.position.x-t.position.x}))[0],p=-450;if(h){var g=h.position.x,x=m-g,y=-1800/this.gravity;if(y>.05){p=-x/y;var b=Math.abs(p);b>1400&&(p=-1400),b<150&&(p=-150)}console.log("[SpikeBounce] to previous spike dx=",x.toFixed(1),"vx=",p.toFixed(1),"time=",y.toFixed(3))}else console.log("[SpikeBounce] first spike: use default vx=",p);this._velocityX=p,this._velocityY=900,this._isJumping=!0,console.log("[Landing] Spike bounce left x=",r.position.x.toFixed(1));var _=this.nextKindAndToggle(),w=this.spawnAdjacentPlatform(_);w&&(this._nextPlatform=w,this.updateCamera())}else{this._currentPlatform=r;var k,T=this.nextKindAndToggle(),S=this.spawnAdjacentPlatform(T);if(S)this._nextPlatform=S,this.updateCamera(),console.log("[Landing] Normal landed -> generated next",null==(k=S.getComponent(v))?void 0:k.kind)}}else console.log("[Landing] miss all platforms pX=",e.toFixed(1))}},o.updateCamera=function(){if(this.camera&&this.player){var t=this.camera.node,e=this.player.position.x+this.cameraOffsetX,i=t.position,n=i.x+.15*(e-i.x),r=this._cameraBaseY+this.cameraOffsetY;t.setPosition(n,r,i.z)}},o.ensureFuturePlatform=function(){if(this.player){var t=this.player.position.x+2e3,e=this.getRightmostPlatform();if(e)for(;;){if(e.position.x+.5*this.getPlatformWidth(e)>=t)break;var i=this.nextKindAndToggle(),n=this.spawnAdjacentPlatform(i);if(!n)break;e=n,this._nextPlatform=n,console.log("[FutureGen] 紧贴补平台 kind=",P[i],"x=",n.position.x)}}},e}(y)).prototype,"player",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(C.prototype,"camera",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(C.prototype,"normalPlatformPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(C.prototype,"spikePlatformPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(C.prototype,"normminDistance",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),N=e(C.prototype,"normmaxDistance",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),Y=e(C.prototype,"spikeminDistance",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),O=e(C.prototype,"spikemaxDistance",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),A=e(C.prototype,"jumpPowerFactor",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),I=e(C.prototype,"gravity",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-2200}}),M=e(C.prototype,"leftBoundaryX",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),j=e(C.prototype,"cameraOffsetX",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),B=e(C.prototype,"cameraOffsetY",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-40}}),G=e(C.prototype,"playerXLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(C.prototype,"labelOffsetX",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-200}}),J=e(C.prototype,"labelOffsetY",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),X=C))||X));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BackgroundScroller.ts","./GameManager.ts","./PlatformType.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlatformType.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,t,n,i,o,a,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,t=r.inheritsLoose,n=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){o=r.cclegacy,a=r._decorator,l=r.Component}],execute:function(){var c,p,u,s,f;o._RF.push({},"be156r4ERBC2ZtP+OblATa0","PlatformType",void 0);var y=a.ccclass,m=a.property,d=r("PlatformKind",function(r){return r[r.Normal=0]="Normal",r[r.Spike=1]="Spike",r}({}));r("PlatformType",(c=y("PlatformType"),p=m({type:d}),c((f=e((s=function(r){function e(){for(var e,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=r.call.apply(r,[this].concat(o))||this,n(e,"kind",f,i(e)),e}return t(e,r),e}(l)).prototype,"kind",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.Normal}}),u=s))||u));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});